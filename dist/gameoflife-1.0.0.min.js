(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";var Event=function(s){this.publisher=s,this.subscribers=[]};Event.prototype={subscribe:function(s){this.subscribers.indexOf(s)<0&&this.subscribers.push(s)},unsubscribe:function(s){var i=this.subscribers.indexOf(s);i>-1&&this.subscribers.splice(i,1)},fire:function(s){var i=this.publisher;this.subscribers.forEach(function(r){r(i,s)})}},module.exports=Event;
},{}],2:[function(require,module,exports){
var Life=require("./life.js"),LifeController=require("./life-controller.js"),LifeView=require("./life-view.js"),ROWS=100,COLS=100;!function(){"use strict";var e=document.getElementById("life"),i=Life.from(ROWS,COLS,function(){return Math.random()>.5?1:0}),r=new LifeView(i,e);new LifeController(i,r).togglePlay(r)}();
},{"./life-controller.js":3,"./life-view.js":4,"./life.js":5}],3:[function(require,module,exports){
"use strict";var SMA=require("./moving_average.js"),LOG_MIN=6.907755278982137,LOG_SCALE=-.06907755278982136,SMA_SAMPLES=100,LifeController=function(i,t){this.life=i,this.lifeView=t,this.initialState=i.cells,this.playing=!1,this.init()};LifeController.prototype={init:function(){console.log((Math.log(1)-Math.log(1e3))/100),this.lifeView.playButtonClicked.subscribe(this.togglePlay.bind(this)),this.lifeView.resetButtonClicked.subscribe(this.reset.bind(this)),this.lifeView.throttleChanged.subscribe(this.throttle.bind(this)),this.throttle(this.lifeView),this.animate()},togglePlay:function(i){this.playing?(this.playing=!1,i.setPaused()):(this.playing=!0,i.setPlaying())},reset:function(i){this.life.cells=this.initialState,this.playing||i.draw(this.life)},animate:function(){var i=Date.now();if(this.then||(this.then=i),window.requestAnimationFrame(this.animate.bind(this)),this.playing){var t=i-this.then;t>this.interval&&(this.then=i-t%this.interval,this.life.next(),this.frequency.push(1e3/t)),this.lifeView.frequencyLabel.innerText=this.frequency.average().toFixed(2)+" Hz"}},throttle:function(i){this.interval=Math.exp(LOG_MIN+LOG_SCALE*i.throttleSlider.value),this.frequency=new SMA(SMA_SAMPLES)}},module.exports=LifeController;
},{"./moving_average.js":6}],4:[function(require,module,exports){
"use strict";var Event=require("./event.js"),WIDTH=500,HEIGHT=500,TXT_PAUSE="Pause",TXT_PLAY="Play",TXT_RESET="Reset",LifeView=function(t,e){this.life=t,this.lifeDiv=e,this.playButtonClicked=new Event(this),this.resetButtonClicked=new Event(this),this.throttleChanged=new Event(this),this.init()};LifeView.prototype={init:function(){this.canvas=document.createElement("canvas"),this.canvas.width=WIDTH,this.canvas.height=HEIGHT,this.lifeDiv.appendChild(this.canvas),this.controlsDiv=document.createElement("div"),this.lifeDiv.appendChild(this.controlsDiv),this.playButton=document.createElement("button"),this.playButton.addEventListener("click",function(){this.playButtonClicked.fire()}.bind(this)),this.controlsDiv.appendChild(this.playButton),this.resetButton=document.createElement("button"),this.resetButton.innerText=TXT_RESET,this.resetButton.addEventListener("click",function(){this.resetButtonClicked.fire()}.bind(this)),this.controlsDiv.appendChild(this.resetButton),this.throttleSlider=document.createElement("input"),this.throttleSlider.setAttribute("type","range"),this.throttleSlider.addEventListener("change",function(){this.throttleChanged.fire()}.bind(this)),this.controlsDiv.appendChild(this.throttleSlider),this.frequencyLabel=document.createElement("label"),this.controlsDiv.appendChild(this.frequencyLabel),this.life.changed.subscribe(this.draw.bind(this)),this.setPaused()},setPaused:function(){this.playButton.innerText=TXT_PLAY},setPlaying:function(){this.playButton.innerText=TXT_PAUSE},draw:function(t){var e=this.canvas.getContext("2d");e.clearRect(0,0,this.canvas.width,this.canvas.height),e.fillStyle="black",this.life.cells.forEach(function(t,i){return t.forEach(function(t,n){1===t&&e.fillRect(5*i,5*n,5,5)})})}},module.exports=LifeView;
},{"./event.js":1}],5:[function(require,module,exports){
'use strict'

var Event = require('./event.js')

var Life = function (cells) {
  this.cells = cells || []
  this.changed = new Event(this)
}

Life.prototype = {
  next: function () {
    this.cells = this.cells.map(function (col, x) {
      return col.map(function (state, y) {
        var neighbors = this.neighbors(x, y)
        switch (state) {
          case 0: if (neighbors === 3) state = 1; break
          case 1: if (neighbors < 2 || neighbors > 3) state = 0; break
        }
        return state
      }, this)
    }, this)
    this.changed.fire()
  },
  neighbors: function (x, y) {
    return [
      [x, y - 1],
      [x, y + 1],
      [x - 1, y - 1],
      [x - 1, y],
      [x - 1, y + 1],
      [x + 1, y - 1],
      [x + 1, y],
      [x + 1, y + 1]
    ].map(function ([x, y]) {
      return this.cells[x] && this.cells[x][y] ? this.cells[x][y] : 0
    }, this).reduce(function (sum, val) { return sum + val })
  }
}

Life.from = function (rows, cols, callback) {
  return new Life(Array.from({ length: 100 }, function (x) {
    return Array.from({ length: 100 }, function (y) {
      return callback(x, y)
    })
  }))
}

module.exports = Life

},{"./event.js":1}],6:[function(require,module,exports){
"use strict";var SMA=function(s){this.samples=[],this.maxSamples=s};SMA.prototype={push:function(s){this.samples.push(s),this.samples.length>this.maxSamples&&this.samples.splice(0,1)},average:function(){var s=this.samples.reduce(function(s,e){return s+e},0);return this.samples.length>0?s/this.samples.length:0}},module.exports=SMA;
},{}]},{},[2]);
